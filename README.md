# Malware-Traffic-PCAPs-Analysis

# PCAP #1 
# Scenerio 

You're an analyst at a Security Operations Center (SOC) monitoring the Security Information and Events Manager (SIEM).  The SIEM indicates suspicious activity on a host in your network at 172.16.2.169.  You decide this activity requires further investigation.

In order to determine what happened, you retreive data on the associated events, and you acquire a pcap of network traffic from 172.16.2.169 during that timeframe.  Characteristics of your network are:

- LAN segment:  172.16.2.0/24 (172.16.2.0 through 172.16.2.255)
- Broadcast address:  172.16.2.255
- Domain controller:  172.16.2.9 (FabulousDuke-DC)
- Domain:  fabulousdukes.com

Your task is to figure out what happened.  You should also determine if the host at 172.16.2.169 was actually infected.  

## EXECUTIVE SUMMARY:
On 2018-06-30 at 20:27 UTC, the SOC received alerts indicating a Windows computer utilized
by Lloyd Maxwell downloaded malware disguised as Chrome update from a fake Google
Chrome update page. Further investigation revealed the user was possibly infected with malware. 

## DETAILS:
- IP address: 172.16.2.169
- MAC address: 00:13:92:06:5c:7b
- Host name: Conservator-PC
- User account name: lloyd.maxwell

## INDICATORS:
- 93.95.100.178 port 80 - lw2e.sineadhollywoodnutt.com - various HTTP requests for fake
Chrome update page
- 93.95.100.138 port 80 -  bb17eb22.login3.kimbrelelectric.com  - most likely where malware was downloaded. 
- 107.170.231.118 port 4143 - attempted TCP connections, but no response from the server

## DETAILS

Filtering of HTTP requests while excluding UPNP service (legitimate traffic) by using the filter http.request and !(udp.port eq 1900) to retrieve only HTTP request packets and exclude UDP traffic on port 1900.  

![Filtering of HTTP Requests](https://i.imgur.com/wSBsYYq.jpg)

Several GET requests was made to wwww.stmarybahrain.com.  Starting with GET / to retrieve the homepage, then GET /new to reteive a specific page, and lastly GET /new/ to retrieve a different page.  There are also several requests to track.positiverefreshment.org.  There are also GET requests to sineadhollywoodnutt and kimbrelelectric.

![Filtering of HTTP Requests](https://i.imgur.com/bNVdXgG.jpg)

Following the TCP stream of wwww.stmarybahrain.com GET request, the User-Agent string reveals the user's operating system to be Windows NT 6.1, which is Windows 7 and the web browser user used was Google Chrome.  

![TCP Stream](https://i.imgur.com/NKSa20r.jpg)

The filter smb was used to find the hostname, IP address, and the MAC address of the compromised machine.  The Host Annoucement displays that the hostname is CONSERVATOR-PC.  

![SMB](https://i.imgur.com/WC659oH.jpg)

The filter kerberos.CNameString was utilized to identify the Windows account name.  This reveals the account name to be lloyd.maxwell.  

![Kerberos](https://i.imgur.com/yNlSZd2.jpg)

Below are security Alerts were generated for 172.16.2.169 on Security Onion SIEM using the EmergingThreats Pro Ruleset.

![Alert](https://i.imgur.com/CwVntvS.jpg)

The alerts that are highly suspicious that should be investigated are CNC Feodo Tracker, Current Events, and Trojan.  

The filter http.request and ip.addr eq 93.95.100.138 to investigate further into the etpro trojan alert.  

![Trojan](https://i.imgur.com/dVYABpS.jpg)

Upon researching for "kimrelelectric.com", there is an article from Malwarebytes that indicate this is a fakeupdate campaign. 

![FakeUpdate](https://i.imgur.com/ogn2CoE.jpg)

![FakeUpdate Redirect](https://i.imgur.com/pYqSIyj.jpg)

This article indicate that the malware was downloaded through fake updates.

![FakeUpdate Redirect](https://i.imgur.com/aTcq1CW.jpg)

Upon further investigation, it does indeed look like this was malware since we did retrieve positiverefreshment traffic, which is a URL redirection and kimbrelelectric is the C2.

![FakeUpdate Redirect](https://i.imgur.com/ht45raS.jpg)

![Indicator of Compromise](https://i.imgur.com/wcm78Ny.jpg)

When investigating sineadhollywoodnutt, there were multiple chrome files, which is suspicious since chrome files should only be downloaded through Google site.  Sineadhollywoodnutt does not belong to Google.  

![Fake Updates](https://i.imgur.com/0bCTxGQ.jpg)

![Fake Updates](https://i.imgur.com/9FmuN2A.jpg)

When following the HTTP stream of Sineadhollywoodnutt, this was indeed a fake Google Chrome update message on a malicious hosted website.  

![Fake Updates](https://i.imgur.com/CXvGJnF.jpg)

![Fake Updates](https://i.imgur.com/lveTzA2.jpg)

The alert CNC was investigated and this display that there were repeated attempts to establish a tcp connection to a specific IP address on a specific port.  This shows SYN packets and TCP retransmission which is an indicator of persistence connection attempt in malware connections.  

![C2](https://i.imgur.com/lIjpLYv.jpg)
